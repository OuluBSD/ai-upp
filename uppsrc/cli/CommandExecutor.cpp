#include "CommandExecutor.h"
#include "IdeSession.h"
#include <Core/Core.h>
#include "CoreSupervisor.h"

namespace Upp {

CommandExecutor::CommandExecutor(const CommandRegistry& registry, One<IdeSession> session)
    : registry(registry), session(pick(session)) {}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::Invoke(const String& name,
                                        const VectorMap<String, String>& args) {
    // Find the command in the registry
    const Command* cmd = registry.FindByName(name);
    if (!cmd) {
        return InvocationResult(1, "Unknown command: " + name);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    // Validate arguments against command metadata
    for (const Argument& arg : cmd->inputs) {
        if (arg.required && !args.Find(arg.name)) {
            return InvocationResult(1, "Missing required argument: " + arg.name);
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    // Dispatch to appropriate handler based on command name
    if (name == "open_file") {
        return HandleOpenFile(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "save_file") {
        return HandleSaveFile(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "find_in_files") {
        return HandleFindInFiles(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "build_project") {
        return HandleBuildProject(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "clean_project") {
        return HandleCleanProject(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "goto_line") {
        return HandleGotoLine(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "search_code") {
        return HandleSearchCode(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "show_console") {
        return HandleShowConsole(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "show_errors") {
        return HandleShowErrors(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "set_main_package") {
        return HandleSetMainPackage(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "insert_text") {
        return HandleInsertText(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "erase_range") {
        return HandleEraseRange(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "replace_all") {
        return HandleReplaceAll(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "undo") {
        return HandleUndo(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "redo") {
        return HandleRedo(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "find_definition") {
        return HandleFindDefinition(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "find_usages") {
        return HandleFindUsages(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "get_build_order") {
        return HandleGetBuildOrder(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "detect_cycles") {
        return HandleDetectCycles(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "affected_packages") {
        return HandleAffectedPackages(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "rename_symbol") {
        return HandleRenameSymbol(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "remove_dead_includes") {
        return HandleRemoveDeadIncludes(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "canonicalize_includes") {
        return HandleCanonicalizeIncludes(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "describe_command") {
        return HandleDescribeCommand(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "workspace_stats") {
        return HandleWorkspaceStats(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "package_stats") {
        return HandlePackageStats(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "file_complexity") {
        return HandleFileComplexity(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "graph_stats") {
        return HandleGraphStats(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "edit_history") {
        return HandleEditHistory(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "optimize_package") {
        return HandleOptimizePackage(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "get_optimization_plan") {
        return HandleGetOptimizationPlan(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "workspace_plan") {
        return HandleGetWorkspacePlan(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "list_strategies") {
        return HandleListStrategies(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "get_strategy") {
        return HandleGetStrategy(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "set_strategy") {
        return HandleSetStrategy(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "supervisor_front") {
        return HandleSupervisorFront(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "supervisor_rank") {
        return HandleSupervisorRank(args);
    }
    else if (name == "supervisor_predict") {
        return HandleSupervisorPredict(args);
    }
    else if (name == "memory_export") {
        return HandleMemoryExport(args);
    }
    else if (name == "memory_import") {
        return HandleMemoryImport(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "semantic_entities") {
        return HandleSemanticEntities(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "semantic_clusters") {
        return HandleSemanticClusters(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "semantic_find") {
        return HandleSemanticFind(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "semantic_analyze") {
        return HandleSemanticAnalyze(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "semantic_subsystems") {
        return HandleSemanticSubsystems(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "semantic_entity") {
        return HandleSemanticEntity(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "semantic_roles") {
        return HandleSemanticRoles(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "semantic_layers") {
        return HandleSemanticLayers(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "semantic_behavior") {
        return HandleSemanticBehavior(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "semantic_behavior_entity") {
        return HandleSemanticBehaviorEntity(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "semantic_behavior_graph") {
        return HandleSemanticBehaviorGraph(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "semantic_pipeline") {
        return HandleSemanticPipeline(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "semantic_patterns") {
        return HandleSemanticPatterns(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "semantic_antipatterns") {
        return HandleSemanticAntiPatterns(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "semantic_architecture") {
        return HandleSemanticArchitecture(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "semantic_outliers") {
        return HandleSemanticOutliers(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "build_scenario") {
        return HandleBuildScenario(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "simulate_scenario") {
        return HandleSimulateScenario(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "apply_scenario") {
        return HandleApplyScenario(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    else if (name == "export_proposal") {
        return HandleExportProposal(args);
    }
    else if (name == "global_stats") {
        return HandleGlobalStats(args);
    }
    else if (name == "global_predict") {
        return HandleGlobalPredict(args);
    }
    else if (name == "export_global_knowledge") {
        return HandleExportGlobalKnowledge(args);
    }
    else if (name == "import_global_knowledge") {
        return HandleImportGlobalKnowledge(args);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    // Special case for list_commands (not in metadata)
    else if (name == "list_commands") {
        Vector<Command> allCmds = registry.ListCommands();
        String msg = "Available commands:\n";
        ValueArray payload_array;
        for (const Command& c : allCmds) {
            msg += c.name + " (" + c.category + "): " + c.description + "\n";
            ValueMap cmd_info;
            cmd_info.Add("name", c.name);
            cmd_info.Add("category", c.category);
            cmd_info.Add("description", c.description);
            payload_array.Add(cmd_info);
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

        InvocationResult result_struct;
        result_struct.status_code = 0;
        result_struct.message = msg;
        result_struct.payload = payload_array;
        return result_struct;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    return {1, "Unimplemented command: " + name}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleOpenFile(const VectorMap<String, String>& args) {
    String path = args.Get("path", "");
    String error;

    if (!session->OpenFile(path, error)) {
        return {1, "Failed to open file '" + path + "': " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    return {0, "Opened file '" + path + "'"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleSaveFile(const VectorMap<String, String>& args) {
    String path = args.Get("path", "current");
    String error;

    if (path == "current") {
        // For now, we can't save "current" file from CLI - require explicit path
        return {1, "Saving without explicit path is not yet supported from CLI"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    if (!session->SaveFile(path, error)) {
        return {1, "Failed to save file '" + path + "': " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    return {0, "Saved file '" + path + "'"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleFindInFiles(const VectorMap<String, String>& args) {
    String pattern = args.Get("pattern", "");
    String directory = args.Get("directory", ".");

    String result, error;
    if (!session->FindInFiles(pattern, directory, result, error)) {
        return {1, "Failed to find in files: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    // Parse the result to create structured payload
    Vector<String> lines = Split(result, "\n");
    ValueArray payload_array;
    String output_result = "Find in files completed:\n";

    for (const String& line : lines) {
        if (!line.IsEmpty()) {
            output_result += line + "\n";
            // Try to parse "file:line:content" format if available
            Vector<String> parts = Split(line, ':');
            if (parts.GetCount() >= 3) {
                ValueMap entry;
                entry.Add("file", parts[0]);
                entry.Add("line", ScanInt(parts[1]));
                String content = parts[2];
                for (int i = 3; i < parts.GetCount(); i++) {
                    content += ":" + parts[i];
                }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
                entry.Add("content", content);
                payload_array.Add(entry);
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation else {
                // If format doesn't match, just add the line as content
                ValueMap entry;
                entry.Add("content", line);
                payload_array.Add(entry);
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = output_result;
    result_struct.payload = payload_array;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleBuildProject(const VectorMap<String, String>& args) {
    String name = args.Get("name", "");
    String config = args.Get("config", "Debug");
    String log, error;

    if (!session->BuildProject(name, config, log, error)) {
        return {1, "Failed to build project '" + name + "' with config '" + config + "': " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String result = "Build completed for project '" + name + "' with config '" + config + "'\nLog:\n" + log;

    ValueMap payload_map;
    payload_map.Add("project", name);
    payload_map.Add("config", config);
    payload_map.Add("log", log);
    payload_map.Add("success", true);

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = result;
    result_struct.payload = payload_map;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleCleanProject(const VectorMap<String, String>& args) {
    String name = args.Get("name", "");
    String log, error;

    if (!session->CleanProject(name, log, error)) {
        return {1, "Failed to clean project '" + name + "': " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String result = "Clean completed for project '" + name + "'\nLog:\n" + log;

    ValueMap payload_map;
    payload_map.Add("project", name);
    payload_map.Add("log", log);
    payload_map.Add("success", true);

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = result;
    result_struct.payload = payload_map;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleGotoLine(const VectorMap<String, String>& args) {
    String lineStr = args.Get("line", "1");
    String file = args.Get("file", "");

    int line = ScanInt(lineStr);  // Convert string to integer
    String error;

    if (!session->GotoLine(file, line, error)) {
        return {1, "Failed to go to line " + IntStr(line) + " in file '" + file + "': " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    return {0, "Navigated to line " + IntStr(line) + " in file '" + file + "'"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleSearchCode(const VectorMap<String, String>& args) {
    String query = args.Get("query", "");

    String result, error;
    if (!session->SearchCode(query, result, error)) {
        return {1, "Failed to search code: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    // Parse the result to create structured payload
    Vector<String> lines = Split(result, "\n");
    ValueArray payload_array;
    String output_result = "Search code completed:\n";

    for (const String& line : lines) {
        if (!line.IsEmpty()) {
            output_result += line + "\n";
            // Try to parse "file:line:content" format if available
            Vector<String> parts = Split(line, ':');
            if (parts.GetCount() >= 3) {
                ValueMap entry;
                entry.Add("file", parts[0]);
                entry.Add("line", ScanInt(parts[1]));
                String content = parts[2];
                for (int i = 3; i < parts.GetCount(); i++) {
                    content += ":" + parts[i];
                }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
                entry.Add("content", content);
                payload_array.Add(entry);
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation else {
                // If format doesn't match, just add the line as content
                ValueMap entry;
                entry.Add("content", line);
                payload_array.Add(entry);
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = output_result;
    result_struct.payload = payload_array;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleShowConsole(const VectorMap<String, String>& args) {
    String error;
    if (!session->ShowConsole(error)) {
        return {1, "Failed to access console: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    // Get the console output
    String output;
    if (!session->GetConsoleOutput(output, error)) {
        return {1, "Failed to retrieve console output: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    return {0, "Console output:\n" + output}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleShowErrors(const VectorMap<String, String>& args) {
    String error;
    if (!session->ShowErrors(error)) {
        return {1, "Failed to access errors: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    // Get the errors output
    String output;
    if (!session->GetErrorsOutput(output, error)) {
        return {1, "Failed to retrieve errors output: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    return {0, "Errors output:\n" + output}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleSetMainPackage(const VectorMap<String, String>& args) {
    String pkg = args.Get("package", "");
    String error;

    if (!session->SetMainPackage(pkg, error)) {
        return {1, "Failed to set main package to '" + pkg + "': " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    return {0, "Set main package to '" + pkg + "'"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleInsertText(const VectorMap<String, String>& args) {
    String path = args.Get("path", "");
    String posStr = args.Get("pos", "0");
    String text = args.Get("text", "");

    int pos = ScanInt(posStr);
    if (pos < 0) {
        return {1, "Invalid position: " + posStr}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String error;
    if (!session->EditorInsert(path, pos, text, error)) {
        return {1, "Failed to insert text: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    return {0, "Inserted text into '" + path + "' at position " + IntStr(pos) + "."}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleEraseRange(const VectorMap<String, String>& args) {
    String path = args.Get("path", "");
    String posStr = args.Get("pos", "0");
    String countStr = args.Get("count", "0");

    int pos = ScanInt(posStr);
    int count = ScanInt(countStr);
    if (pos < 0 || count < 0) {
        return {1, "Invalid position or count: " + posStr + ", " + countStr}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String error;
    if (!session->EditorErase(path, pos, count, error)) {
        return {1, "Failed to erase range: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    return {0, "Erased " + IntStr(count) + " characters in '" + path + "' starting at position " + IntStr(pos) + "."}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleReplaceAll(const VectorMap<String, String>& args) {
    String path = args.Get("path", "");
    String pattern = args.Get("pattern", "");
    String replacement = args.Get("replacement", "");
    String caseSensitiveStr = args.Get("case_sensitive", "true");

    bool case_sensitive = true;
    if (caseSensitiveStr == "false" || caseSensitiveStr == "0") {
        case_sensitive = false;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String error;
    int count;
    if (!session->EditorReplaceAll(path, pattern, replacement, case_sensitive, count, error)) {
        return {1, "Failed to replace all: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String result = "Replaced " + IntStr(count) + " occurrences in '" + path + "'.";

    ValueMap payload_map;
    payload_map.Add("count", count);
    payload_map.Add("path", path);
    payload_map.Add("pattern", pattern);
    payload_map.Add("replacement", replacement);
    payload_map.Add("case_sensitive", case_sensitive);

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = result;
    result_struct.payload = payload_map;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleGotoLine(const VectorMap<String, String>& args) {
    String lineStr = args.Get("line", "1");
    String file = args.Get("file", "");

    int line = ScanInt(lineStr);
    String error;
    int pos;
    if (!session->EditorGotoLine(file, line, pos, error)) {
        return {1, "Failed to go to line " + IntStr(line) + " in file '" + file + "': " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String result = "Moved to line " + IntStr(line) + " (pos " + IntStr(pos) + ") in '" + file + "'.";

    ValueMap payload_map;
    payload_map.Add("file", file);
    payload_map.Add("line", line);
    payload_map.Add("pos", pos);

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = result;
    result_struct.payload = payload_map;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleUndo(const VectorMap<String, String>& args) {
    String path = args.Get("path", "");
    String error;

    if (!session->EditorUndo(path, error)) {
        return {1, "Failed to undo: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    return {0, "Undid last edit in '" + path + "'."}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleRedo(const VectorMap<String, String>& args) {
    String path = args.Get("path", "");
    String error;

    if (!session->EditorRedo(path, error)) {
        return {1, "Failed to redo: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    return {0, "Redid last undone edit in '" + path + "'."}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleFindDefinition(const VectorMap<String, String>& args) {
    String symbol = args.Get("symbol", "");
    if (symbol.IsEmpty()) {
        return {1, "Missing required argument: symbol"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String file, error;
    int line = -1;
    if (!session->FindDefinition(symbol, file, line, error)) {
        return {1, "Failed to find definition for symbol '" + symbol + "': " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String result = "Definition found: " + file + ":" + IntStr(line);

    ValueMap payload_map;
    payload_map.Add("file", file);
    payload_map.Add("line", line);
    payload_map.Add("symbol", symbol);

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = result;
    result_struct.payload = payload_map;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleFindUsages(const VectorMap<String, String>& args) {
    String symbol = args.Get("symbol", "");
    if (symbol.IsEmpty()) {
        return {1, "Missing required argument: symbol"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    Vector<String> locations;
    String error;
    if (!session->FindUsages(symbol, locations, error)) {
        return {1, "Failed to find usages for symbol '" + symbol + "': " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String result = "Usages found for symbol '" + symbol + "':\n";
    ValueArray payload_array;
    for (const String& loc : locations) {
        result += "  " + loc + "\n";
        // Parse location format "file:line" and convert to structured format
        int colon_pos = loc.ReverseFind(':');
        if (colon_pos > 0) {
            String file = loc.Mid(0, colon_pos);
            String line_str = loc.Mid(colon_pos + 1);
            int line = ScanInt(line_str);
            ValueMap entry;
            entry.Add("file", file);
            entry.Add("line", line);
            payload_array.Add(entry);
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation else {
            // If format is not "file:line", just add the whole location as a file
            ValueMap entry;
            entry.Add("file", loc);
            payload_array.Add(entry);
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = result;
    result_struct.payload = payload_array;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

// Graph command handlers
InvocationResult CommandExecutor::HandleGetBuildOrder(const VectorMap<String, String>& args) {
    Vector<String> build_order;
    String error;

    if (!session->GetBuildOrder(build_order, error)) {
        return {1, "Failed to get build order: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String result = "Build order:\n";
    ValueArray payload_array;
    for (int i = 0; i < build_order.GetCount(); i++) {
        result += IntStr(i + 1) + ". " + build_order[i] + "\n";
        payload_array.Add(build_order[i]);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = result;
    result_struct.payload = payload_array;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleDetectCycles(const VectorMap<String, String>& args) {
    Vector<Vector<String>> cycles;
    String error;

    if (!session->FindCycles(cycles, error)) {
        return {1, "Failed to detect cycles: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String result = "Cycles detected in package dependencies:\n";
    ValueArray payload_array;

    if (cycles.GetCount() == 0) {
        result = "No cycles detected in package dependencies.";
        payload_array.Add("No cycles detected");
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation else {
        for (int i = 0; i < cycles.GetCount(); i++) {
            result += "Cycle " + IntStr(i + 1) + ": ";
            ValueArray cycle_packages;
            for (int j = 0; j < cycles[i].GetCount(); j++) {
                if (j > 0) result += " -> ";
                result += cycles[i][j];
                cycle_packages.Add(cycles[i][j]);
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
            result += "\n";
            payload_array.Add(cycle_packages);
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = result;
    result_struct.payload = payload_array;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleAffectedPackages(const VectorMap<String, String>& args) {
    String path = args.Get("path", "");
    if (path.IsEmpty()) {
        return {1, "Missing required argument: path"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    Vector<String> affected_packages;
    String error;

    if (!session->AffectedPackages(path, affected_packages, error)) {
        return {1, "Failed to get affected packages for file '" + path + "': " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String result = "Packages affected by changes to '" + path + "':\n";
    ValueArray payload_array;
    for (int i = 0; i < affected_packages.GetCount(); i++) {
        result += "- " + affected_packages[i] + "\n";
        payload_array.Add(affected_packages[i]);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = result;
    result_struct.payload = payload_array;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

// Refactoring command handlers
InvocationResult CommandExecutor::HandleRenameSymbol(const VectorMap<String, String>& args) {
    String old_name = args.Get("old", "");
    String new_name = args.Get("new", "");

    if (old_name.IsEmpty()) {
        return {1, "Missing required argument: old"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    if (new_name.IsEmpty()) {
        return {1, "Missing required argument: new"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String error;
    if (!session->RenameSymbol(old_name, new_name, error)) {
        return {1, "Failed to rename symbol from '" + old_name + "' to '" + new_name + "': " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String result = "Successfully renamed symbol from '" + old_name + "' to '" + new_name + "'";

    ValueMap payload_map;
    payload_map.Add("old", old_name);
    payload_map.Add("new", new_name);
    payload_map.Add("success", true);

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = result;
    result_struct.payload = payload_map;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleRemoveDeadIncludes(const VectorMap<String, String>& args) {
    String path = args.Get("path", "");
    if (path.IsEmpty()) {
        return {1, "Missing required argument: path"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String error;
    int count; // We'll track how many includes were removed
    if (!session->RemoveDeadIncludes(path, error, &count)) {
        return {1, "Failed to remove dead includes in file '" + path + "': " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String result = "Successfully removed " + IntStr(count) + " dead includes in file '" + path + "'";

    ValueMap payload_map;
    payload_map.Add("count", count);
    payload_map.Add("path", path);

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = result;
    result_struct.payload = payload_map;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleCanonicalizeIncludes(const VectorMap<String, String>& args) {
    String path = args.Get("path", "");
    if (path.IsEmpty()) {
        return {1, "Missing required argument: path"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String error;
    int count = 0;
    if (!session->CanonicalizeIncludes(path, error, &count)) {
        return {1, "Failed to canonicalize includes in file '" + path + "': " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String result = "Successfully canonicalized " + IntStr(count) + " include(s) in file '" + path + "'";

    ValueMap payload_map;
    payload_map.Add("count", count);
    payload_map.Add("path", path);

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = result;
    result_struct.payload = payload_map;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleDescribeCommand(const VectorMap<String, String>& args) {
    String name = args.Get("name", "");
    if (name.IsEmpty()) {
        return {1, "Missing required argument: name"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    const Command* cmd = registry.FindByName(name);
    if (!cmd) {
        return {1, "Command not found: " + name}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    // Create structured payload with command metadata
    ValueMap payload;
    payload.Add("name", cmd->name);
    payload.Add("category", cmd->category);
    payload.Add("description", cmd->description);
    payload.Add("long_description", cmd->long_description);

    // Add inputs (arguments)
    ValueArray inputs_array;
    for (const Argument& input : cmd->inputs) {
        ValueMap input_map;
        input_map.Add("name", input.name);
        input_map.Add("type", input.type);
        input_map.Add("required", input.required);
        input_map.Add("default", input.default_value);
        input_map.Add("description", input.description);

        if (!input.enum_values.IsEmpty()) {
            ValueArray enum_array;
            for (const String& enum_val : input.enum_values) {
                enum_array.Add(enum_val);
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
            input_map.Add("enum_values", enum_array);
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

        inputs_array.Add(input_map);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    payload.Add("inputs", inputs_array);

    // Add outputs
    ValueMap outputs_map;
    outputs_map.Add("kind", cmd->output.kind);

    if (!cmd->output.fields.IsEmpty()) {
        ValueArray fields_array;
        for (const String& field : cmd->output.fields) {
            fields_array.Add(field);
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
        outputs_map.Add("fields", fields_array);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    payload.Add("outputs", outputs_map);

    // Add side effects
    ValueMap side_effects_map;
    side_effects_map.Add("modifies_files", cmd->side_effects.modifies_files);
    side_effects_map.Add("modifies_project", cmd->side_effects.modifies_project);
    side_effects_map.Add("requires_open_project", cmd->side_effects.requires_open_project);
    side_effects_map.Add("requires_open_file", cmd->side_effects.requires_open_file);
    payload.Add("side_effects", side_effects_map);

    payload.Add("context_notes", cmd->context_notes);

    // Create human-readable message
    String msg = "Command: " + cmd->name + "\n";
    msg += "Category: " + cmd->category + "\n";
    msg += "Description: " + cmd->description + "\n";
    msg += "Arguments:\n";
    for (const Argument& input : cmd->inputs) {
        msg += "  " + input.name + " (" + input.type + "): " + input.description;
        if (input.required) msg += " [required]";
        if (!input.default_value.IsEmpty()) msg += " [default: " + input.default_value + "]";
        msg += "\n";
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result;
    result.status_code = 0;
    result.message = msg;
    result.payload = payload;
    return result;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

// Telemetry handler implementations
InvocationResult CommandExecutor::HandleWorkspaceStats(const VectorMap<String, String>& args) {
    String error;
    Value result = session->GetWorkspaceStats(error);

    if (error.GetCount() > 0) {
        return {1, "Failed to get workspace stats: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Workspace stats retrieved";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandlePackageStats(const VectorMap<String, String>& args) {
    String pkg = args.Get("package", "");
    if (pkg.IsEmpty()) {
        return {1, "Missing required argument: package"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String error;
    Value result = session->GetPackageStats(pkg, error);

    if (error.GetCount() > 0) {
        return {1, "Failed to get package stats for '" + pkg + "': " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Package stats for '" + pkg + "' retrieved";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleFileComplexity(const VectorMap<String, String>& args) {
    String path = args.Get("path", "");
    if (path.IsEmpty()) {
        return {1, "Missing required argument: path"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String error;
    Value result = session->GetFileComplexity(path, error);

    if (error.GetCount() > 0) {
        return {1, "Failed to get file complexity for '" + path + "': " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "File complexity for '" + path + "' retrieved";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleGraphStats(const VectorMap<String, String>& args) {
    String error;
    Value result = session->GetGraphStats(error);

    if (error.GetCount() > 0) {
        return {1, "Failed to get graph stats: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Graph stats retrieved";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleEditHistory(const VectorMap<String, String>& args) {
    String error;
    Value result = session->GetEditHistory(error);

    if (error.GetCount() > 0) {
        return {1, "Failed to get edit history: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Edit history retrieved";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

// Optimization Loop v1 handler
InvocationResult CommandExecutor::HandleOptimizePackage(const VectorMap<String, String>& args) {
    String package = args.Get("name", "");
    if (package.IsEmpty()) {
        return {1, "Missing required argument: name"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    // Parse optional parameters with defaults
    int max_iterations = ScanInt(args.Get("max_iterations", "5"));
    double converge_threshold = ScanDouble(args.Get("converge_threshold", "0.01"));
    bool stop_on_worse = args.Get("stop_on_worse", "true") == "true";
    bool stop_on_converge = args.Get("stop_on_converge", "true") == "true";

    String error;
    Value result = session->OptimizePackage(
        package,
        max_iterations,
        converge_threshold,
        stop_on_worse,
        stop_on_converge,
        error
    );

    if (error.GetCount() > 0) {
        return {1, "Failed to optimize package '" + package + "': " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    // Create result struct
    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Optimization completed for package '" + package + "'";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

// AI Supervisor Layer v1 handler
InvocationResult CommandExecutor::HandleGetOptimizationPlan(const VectorMap<String, String>& args) {
    String package = args.Get("name", "");
    if (package.IsEmpty()) {
        return {1, "Missing required argument: name"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String error;
    Value result = session->GetOptimizationPlan(package, error);

    if (error.GetCount() > 0) {
        return {1, "Failed to generate optimization plan for '" + package + "': " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    // Create result struct
    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Optimization plan generated for package '" + package + "'";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleGetWorkspacePlan(const VectorMap<String, String>& args) {
    String error;
    Value result = session->GetWorkspacePlan(error);

    if (error.GetCount() > 0) {
        return {1, "Failed to generate workspace plan: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    // Create result struct
    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Workspace optimization plan generated";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

// Dynamic Strategy Engine handlers
InvocationResult CommandExecutor::HandleListStrategies(const VectorMap<String, String>& args) {
    String error;
    Value result = session->ListStrategies(error);

    if (error.GetCount() > 0) {
        return {1, "Failed to list strategies: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    // Create result struct
    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Successfully retrieved strategy list";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleGetStrategy(const VectorMap<String, String>& args) {
    String strategy_name = args.Get("name", "active");
    String error;

    Value result;
    if (strategy_name == "active") {
        // Get the currently active strategy
        result = session->GetActiveStrategy(error);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation else {
        // Get a specific strategy by name
        result = session->GetStrategy(strategy_name, error);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    if (error.GetCount() > 0) {
        return {1, "Failed to get strategy: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    // Create result struct
    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Successfully retrieved strategy information";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleSetStrategy(const VectorMap<String, String>& args) {
    String strategy_name = args.Get("name", "");
    if (strategy_name.IsEmpty()) {
        return {1, "Missing required argument: name"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String error;
    bool success = session->SetActiveStrategy(strategy_name, error);

    if (!success) {
        return {1, "Failed to set strategy to '" + strategy_name + "': " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    // Create result struct
    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Successfully set active strategy to '" + strategy_name + "'";
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

// Supervisor v3: Multi-Objective Planner command handlers
InvocationResult CommandExecutor::HandleSupervisorFront(const VectorMap<String, String>& args) {
    String package = args.Get("package", "");
    if (package.IsEmpty()) {
        return {1, "Missing required argument: package"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String error;
    Value result = session->GetOptimizationPlan(package, error);

    if (error.GetCount() > 0) {
        return {1, "Failed to generate optimization plan for '" + package + "': " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    // Extract the suggestions from the plan
    Vector<CoreSupervisor::Suggestion> suggestions;
    if (result.Is<ValueMap>()) {
        ValueMap plan = result;
        ValueArray steps = plan.Get("steps", ValueArray());

        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].Is<ValueMap>()) {
                ValueMap step = steps[i];

                CoreSupervisor::Suggestion suggestion;
                suggestion.action = (String)step.Get("action", "");
                suggestion.target = (String)step.Get("target", "");
                suggestion.params = step.Get("params", ValueMap());
                suggestion.reason = (String)step.Get("reason", "");
                suggestion.benefit_score = (double)step.Get("benefit_score", 0.0);
                suggestion.cost_score = (double)step.Get("cost_score", 0.0);
                suggestion.risk_score = (double)step.Get("risk_score", 0.0);
                suggestion.confidence_score = (double)step.Get("confidence_score", 0.0);

                // Get metrics map
                ValueMap metrics_map = step.Get("metrics", ValueMap());
                suggestion.metrics = metrics_map;

                suggestions.Add(suggestion);
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    // Instead of creating a new supervisor, let's use the one from the session
    // Extract the supervisor from the session - need to do this differently
    // since we're not calling session->ComputeParetoFront directly

    // For now, create a temporary supervisor to compute the front
    // A more proper way would be adding this functionality to the IdeSession
    CoreSupervisor temp_supervisor;
    Vector<CoreSupervisor::Suggestion> pareto_front = temp_supervisor.ComputeParetoFront(suggestions);

    // Convert suggestions back to ValueArray for payload
    ValueArray payload_array;
    for (const auto& suggestion : pareto_front) {
        ValueMap suggestion_map;
        suggestion_map.Add("action", suggestion.action);
        suggestion_map.Add("target", suggestion.target);
        suggestion_map.Add("params", suggestion.params);
        suggestion_map.Add("reason", suggestion.reason);
        suggestion_map.Add("benefit_score", suggestion.benefit_score);
        suggestion_map.Add("cost_score", suggestion.cost_score);
        suggestion_map.Add("risk_score", suggestion.risk_score);
        suggestion_map.Add("confidence_score", suggestion.confidence_score);
        suggestion_map.Add("metrics", suggestion.metrics);

        payload_array.Add(suggestion_map);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    // Create result struct
    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Computed Pareto-optimal suggestions for package '" + package + "'";
    result_struct.payload = payload_array;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleSupervisorRank(const VectorMap<String, String>& args) {
    String package = args.Get("package", "");
    if (package.IsEmpty()) {
        return {1, "Missing required argument: package"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String limit_str = args.Get("limit", "10");
    int limit = ScanInt(limit_str);
    if (limit <= 0) {
        limit = 10; // default
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String error;
    Value result = session->GetOptimizationPlan(package, error);

    if (error.GetCount() > 0) {
        return {1, "Failed to generate optimization plan for '" + package + "': " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    // Extract the suggestions from the plan
    Vector<CoreSupervisor::Suggestion> suggestions;
    if (result.Is<ValueMap>()) {
        ValueMap plan = result;
        ValueArray steps = plan.Get("steps", ValueArray());

        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].Is<ValueMap>()) {
                ValueMap step = steps[i];

                CoreSupervisor::Suggestion suggestion;
                suggestion.action = (String)step.Get("action", "");
                suggestion.target = (String)step.Get("target", "");
                suggestion.params = step.Get("params", ValueMap());
                suggestion.reason = (String)step.Get("reason", "");
                suggestion.benefit_score = (double)step.Get("benefit_score", 0.0);
                suggestion.cost_score = (double)step.Get("cost_score", 0.0);
                suggestion.risk_score = (double)step.Get("risk_score", 0.0);
                suggestion.confidence_score = (double)step.Get("confidence_score", 0.0);

                // Get metrics map
                ValueMap metrics_map = step.Get("metrics", ValueMap());
                suggestion.metrics = metrics_map;

                suggestions.Add(suggestion);
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    // Get strategy weights for ranking
    double w_benefit = 1.0;
    double w_cost = 0.7;
    double w_risk = 1.2;
    double w_confidence = 1.0;

    // Try to get objective weights from active strategy
    Value strategy_info = session->GetActiveStrategy(error);
    if (strategy_info.Is<ValueMap>()) {
        ValueMap strategy_map = strategy_info;
        ValueMap objective_weights = strategy_map.Get("objective_weights", ValueMap());
        w_benefit = (double)objective_weights.Get("benefit", 1.0);
        w_cost = (double)objective_weights.Get("cost", 0.7);
        w_risk = (double)objective_weights.Get("risk", 1.2);
        w_confidence = (double)objective_weights.Get("confidence", 1.0);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    // Compute weighted scores and rank suggestions
    Vector< pair<double, int> > scores_with_indices;  // (score, original_index)
    for (int i = 0; i < suggestions.GetCount(); i++) {
        const auto& s = suggestions[i];
        // Use weighted linear combination: score = (benefit_score * w_benefit) + (confidence_score * w_confidence) - (cost_score * w_cost) - (risk_score * w_risk)
        double score = (s.benefit_score * w_benefit) +
                      (s.confidence_score * w_confidence) -
                      (s.cost_score * w_cost) -
                      (s.risk_score * w_risk);

        scores_with_indices.Add(make_pair(score, i));
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    // Sort by score in descending order
    Sort(scores_with_indices, [](const pair<double, int>& a, const pair<double, int>& b) {
        return a.first > b.first;  // Higher scores first
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation);

    // Create ranked result
    ValueArray payload_array;
    int actual_limit = min(limit, scores_with_indices.GetCount());
    for (int i = 0; i < actual_limit; i++) {
        int original_index = scores_with_indices[i].second;
        const auto& s = suggestions[original_index];
        double score = scores_with_indices[i].first;

        ValueMap suggestion_map;
        suggestion_map.Add("action", s.action);
        suggestion_map.Add("target", s.target);
        suggestion_map.Add("params", s.params);
        suggestion_map.Add("reason", s.reason);
        suggestion_map.Add("benefit_score", s.benefit_score);
        suggestion_map.Add("cost_score", s.cost_score);
        suggestion_map.Add("risk_score", s.risk_score);
        suggestion_map.Add("confidence_score", s.confidence_score);
        suggestion_map.Add("metrics", s.metrics);
        suggestion_map.Add("combined_score", score);  // Add the computed combined score

        payload_array.Add(suggestion_map);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    // Create result struct
    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Ranked " + IntStr(actual_limit) + " suggestions for package '" + package + "'";
    result_struct.payload = payload_array;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

// Semantic Analysis v1 handlers
InvocationResult CommandExecutor::HandleSemanticEntities(const VectorMap<String, String>& args) {
    String error;
    Value result = session->GetSemanticEntities(error);

    if (error.GetCount() > 0) {
        return {1, "Failed to retrieve semantic entities: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Successfully retrieved semantic entities";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleSemanticClusters(const VectorMap<String, String>& args) {
    String error;
    Value result = session->GetSemanticClusters(error);

    if (error.GetCount() > 0) {
        return {1, "Failed to retrieve semantic clusters: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Successfully retrieved semantic clusters";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleSemanticFind(const VectorMap<String, String>& args) {
    String pattern = args.Get("pattern", "");
    if (pattern.IsEmpty()) {
        return {1, "Missing required argument: pattern"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String error;
    Value result = session->SearchSemanticEntities(pattern, error);

    if (error.GetCount() > 0) {
        return {1, "Failed to search semantic entities with pattern '" + pattern + "': " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Successfully found semantic entities matching pattern '" + pattern + "'";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleSemanticAnalyze(const VectorMap<String, String>& args) {
    String error;
    // We need to call the semantic analysis directly via the CoreIde
    // Since we don't have direct access to CoreIde from CommandExecutor,
    // we can't trigger a fresh analysis directly through IdeSession interface.
    // This would require adding a method to IdeSession interface to trigger analysis.
    // For now, calling GetSemanticEntities will trigger analysis if needed.

    // Just return status that analysis is complete
    Value entities = session->GetSemanticEntities(error);
    if (error.GetCount() > 0) {
        return {1, "Failed to perform semantic analysis: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    Value clusters = session->GetSemanticClusters(error);
    if (error.GetCount() > 0) {
        return {1, "Failed to retrieve semantic clusters: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    int entity_count = 0;
    if (entities.Is<ValueArray>()) {
        entity_count = entities.GetCount();
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    int cluster_count = 0;
    if (clusters.Is<ValueArray>()) {
        cluster_count = clusters.GetCount();
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    ValueMap payload;
    payload.Add("status", "Semantic analysis completed");
    payload.Add("entity_count", entity_count);
    payload.Add("cluster_count", cluster_count);

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Semantic analysis completed. Found " + IntStr(entity_count) + " entities and " + IntStr(cluster_count) + " clusters.";
    result_struct.payload = payload;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

// NEW: Semantic Analysis v2 - Inference layer handlers
InvocationResult CommandExecutor::HandleSemanticSubsystems(const VectorMap<String, String>& args) {
    String error;
    Value result = session->GetSemanticSubsystems(error);

    if (error.GetCount() > 0) {
        return {1, "Failed to retrieve semantic subsystems: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Successfully retrieved semantic subsystems";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleSemanticEntity(const VectorMap<String, String>& args) {
    String entity_name = args.Get("name", "");
    if (entity_name.IsEmpty()) {
        return {1, "Missing required argument: name"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String error;
    Value result = session->GetSemanticEntity(entity_name, error);

    if (error.GetCount() > 0) {
        return {1, "Failed to retrieve semantic entity '" + entity_name + "': " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Successfully retrieved semantic information for entity '" + entity_name + "'";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleSemanticRoles(const VectorMap<String, String>& args) {
    String error;
    Value result = session->GetSemanticRoles(error);

    if (error.GetCount() > 0) {
        return {1, "Failed to retrieve semantic roles: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Successfully retrieved semantic roles";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleSemanticLayers(const VectorMap<String, String>& args) {
    String error;
    Value result = session->GetSemanticLayers(error);

    if (error.GetCount() > 0) {
        return {1, "Failed to retrieve semantic layers: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Successfully retrieved semantic layers";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

// NEW: Semantic Analysis v3 - Behavioral analysis handlers
InvocationResult CommandExecutor::HandleSemanticBehavior(const VectorMap<String, String>& args) {
    String error;
    Value result = session->GetSemanticBehavior(error);

    if (error.GetCount() > 0) {
        return {1, "Failed to retrieve semantic behavior: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Successfully retrieved semantic behavior for all entities";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleSemanticBehaviorEntity(const VectorMap<String, String>& args) {
    String entity_name = args.Get("name", "");
    if (entity_name.IsEmpty()) {
        return {1, "Missing required argument: name"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String error;
    Value result = session->GetSemanticBehaviorEntity(entity_name, error);

    if (error.GetCount() > 0) {
        return {1, "Failed to retrieve semantic behavior for entity '" + entity_name + "': " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Successfully retrieved semantic behavior for entity '" + entity_name + "'";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleSemanticBehaviorGraph(const VectorMap<String, String>& args) {
    String error;
    Value result = session->GetSemanticBehaviorGraph(error);

    if (error.GetCount() > 0) {
        return {1, "Failed to retrieve semantic behavior graph: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Successfully retrieved semantic behavior graph";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleSemanticPipeline(const VectorMap<String, String>& args) {
    String error;
    Value result = session->GetSemanticPipeline(error);

    if (error.GetCount() > 0) {
        return {1, "Failed to retrieve semantic pipeline: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Successfully retrieved semantic pipeline stages";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

// NEW: SemanticAssist v4 - Architecture diagnostic command handlers
InvocationResult CommandExecutor::HandleSemanticPatterns(const VectorMap<String, String>& args) {
    String error;
    Value result = session->GetSemanticPatterns(error);

    if (error.GetCount() > 0) {
        return {1, "Failed to retrieve semantic patterns: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Successfully retrieved semantic patterns";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleSemanticAntiPatterns(const VectorMap<String, String>& args) {
    String error;
    Value result = session->GetSemanticAntiPatterns(error);

    if (error.GetCount() > 0) {
        return {1, "Failed to retrieve semantic anti-patterns: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Successfully retrieved semantic anti-patterns";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleSemanticArchitecture(const VectorMap<String, String>& args) {
    String error;
    Value result = session->GetSemanticArchitecture(error);

    if (error.GetCount() > 0) {
        return {1, "Failed to retrieve semantic architecture diagnostics: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Successfully retrieved semantic architecture diagnostics";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleSemanticOutliers(const VectorMap<String, String>& args) {
    String error;
    Value result = session->GetSemanticOutliers(error);

    if (error.GetCount() > 0) {
        return {1, "Failed to retrieve semantic outliers: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Successfully retrieved semantic outliers";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

// Scenario operation handlers (PART D)
InvocationResult CommandExecutor::HandleBuildScenario(const VectorMap<String, String>& args) {
    String package = args.Get("package", "");
    if (package.IsEmpty()) {
        return {1, "Missing required argument: package"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String maxActionsStr = args.Get("max_actions", "5");
    int max_actions = ScanInt(maxActionsStr);
    if (max_actions <= 0) {
        max_actions = 5;  // default
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String error;
    Value result = session->BuildScenario(package, max_actions, error);

    if (error.GetCount() > 0) {
        return {1, "Failed to build scenario: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Successfully built scenario plan for package '" + package + "'";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleSimulateScenario(const VectorMap<String, String>& args) {
    String plan_json = args.Get("plan", "");
    if (plan_json.IsEmpty()) {
        return {1, "Missing required argument: plan"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    // Check if plan is a file path or direct JSON
    Value plan_desc;
    if (FileExists(plan_json)) {
        // It's a file path, read the content
        String file_content = LoadFile(plan_json);
        plan_desc = LoadJson(file_content);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation else {
        // It's a direct JSON string
        plan_desc = LoadJson(plan_json);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    if (plan_desc.Is<Error>() || !plan_desc.Is<ValueMap>()) {
        return {1, "Invalid plan format: must be valid JSON object or path to JSON file"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String error;
    Value result = session->SimulateScenario(plan_desc, error);

    if (error.GetCount() > 0) {
        return {1, "Failed to simulate scenario: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Successfully simulated scenario plan";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleApplyScenario(const VectorMap<String, String>& args) {
    String plan_json = args.Get("plan", "");
    if (plan_json.IsEmpty()) {
        return {1, "Missing required argument: plan"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    // Check if plan is a file path or direct JSON
    Value plan_desc;
    if (FileExists(plan_json)) {
        // It's a file path, read the content
        String file_content = LoadFile(plan_json);
        plan_desc = LoadJson(file_content);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation else {
        // It's a direct JSON string
        plan_desc = LoadJson(plan_json);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    if (plan_desc.Is<Error>() || !plan_desc.Is<ValueMap>()) {
        return {1, "Invalid plan format: must be valid JSON object or path to JSON file"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String error;
    Value result = session->ApplyScenario(plan_desc, error);

    if (error.GetCount() > 0) {
        return {1, "Failed to apply scenario: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Successfully applied scenario plan";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleScenarioDiff(const VectorMap<String, String>& args) {
    String plan_json = args.Get("plan", "");
    if (plan_json.IsEmpty()) {
        return {1, "Missing required argument: plan"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    // Check if plan is a file path or direct JSON
    Value plan_desc;
    if (FileExists(plan_json)) {
        // It's a file path, read the content
        String file_content = LoadFile(plan_json);
        plan_desc = LoadJson(file_content);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation else {
        // It's a direct JSON string
        plan_desc = LoadJson(plan_json);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    if (plan_desc.Is<Error>() || !plan_desc.Is<ValueMap>()) {
        return {1, "Invalid plan format: must be valid JSON object or path to JSON file"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    // For scenario_diff, we simulate the scenario without applying changes
    String error;
    Value result = session->SimulateScenario(plan_desc, error);

    if (error.GetCount() > 0) {
        return {1, "Failed to simulate scenario: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Successfully generated scenario diff";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleScenarioRevert(const VectorMap<String, String>& args) {
    String patch_text = args.Get("patch", "");
    String patch_file = args.Get("patch_file", "");

    if (patch_text.IsEmpty() && patch_file.IsEmpty()) {
        return {1, "Missing required argument: either patch or patch_file must be provided"}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    if (!patch_file.IsEmpty()) {
        // Load patch from file if patch_file was provided
        if (!FileExists(patch_file)) {
            return {1, "Patch file does not exist: " + patch_file}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
        patch_text = LoadFile(patch_file);
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    String error;
    Value result = session->RevertPatch(patch_text, error);

    if (error.GetCount() > 0) {
        return {1, "Failed to revert patch: " + error}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation;
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

    InvocationResult result_struct;
    result_struct.status_code = 0;
    result_struct.message = "Successfully reverted patch";
    result_struct.payload = result;
    return result_struct;
// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

// Helper function to convert proposal Value to markdown 
static String ProposalToMarkdown(const Value& proposal) { 
    if (!proposal.IsMap()) { 
        return "# AI Change Proposal\n\nError: Invalid proposal format\n"; 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    const ValueMap& pm = proposal; 
    
    String md = "# AI Change Proposal\n\n"; 
    
    // Add basic info 
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n"; 
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n"; 
    
    // Add scores 
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n"; 
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n"; 
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n"; 
    
    // Add supervisor plan 
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap()); 
    if (supervisor_plan_val.IsMap()) { 
        const ValueMap& sup_plan = supervisor_plan_val; 
        md += "## Supervisor Plan\n\n"; 
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n"; 
        
        ValueArray steps = sup_plan.Get("steps", ValueArray()); 
        md += "**Suggested Actions:**\n\n"; 
        for (int i = 0; i < steps.GetCount(); i++) { 
            if (steps[i].IsMap()) { 
                const ValueMap& step = steps[i]; 
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n"; 
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n"; 
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n"; 
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n"; 
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n"; 
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add scenario plan 
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap()); 
    if (scenario_plan_val.IsMap()) { 
        const ValueMap& scenario_plan = scenario_plan_val; 
        md += "## Scenario Plan\n\n"; 
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n"; 
        
        ValueArray actions = scenario_plan.Get("actions", ValueArray()); 
        md += "**Planned Actions:**\n\n"; 
        for (int i = 0; i < actions.GetCount(); i++) { 
            if (actions[i].IsMap()) { 
                const ValueMap& action = actions[i]; 
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n"; 
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n"; 
            }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
        }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    }

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation 
    
    // Add simulation results 
    md += "## Simulation Results\n\n"; 
    md += "### Before Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n"; 
    
    md += "### After Simulation\n"; 
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n"; 
    
    md += "### Deltas\n"; 
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n"; 
    
    // Add semantic and architecture snapshots 
    md += "## Semantic Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n"; 
    
    md += "## Architecture Snapshot\n"; 
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n"; 
    
    // Add metadata 
    md += "## Metadata\n"; 
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n"; 
    
    return md; 
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation
}

// Helper function to convert proposal Value to markdown
static String ProposalToMarkdown(const Value& proposal) {
    if (!proposal.IsMap()) {
        return "# AI Change Proposal\n\nError: Invalid proposal format\n";
    }

    const ValueMap& pm = proposal;

    String md = "# AI Change Proposal\n\n";

    // Add basic info
    md += "## Package: " + AsString(pm.Get("package", String())) + "\n\n";
    md += "### Proposal ID: " + AsString(pm.Get("id", String())) + "\n\n";

    // Add scores
    md += "### Risk Score: " + AsString(pm.Get("risk_score", 0.0)) + "\n";
    md += "### Confidence Score: " + AsString(pm.Get("confidence_score", 0.0)) + "\n";
    md += "### Benefit Score: " + AsString(pm.Get("benefit_score", 0.0)) + "\n\n";

    // Add supervisor plan
    Value supervisor_plan_val = pm.Get("supervisor_plan", ValueMap());
    if (supervisor_plan_val.IsMap()) {
        const ValueMap& sup_plan = supervisor_plan_val;
        md += "## Supervisor Plan\n\n";
        md += "**Summary:** " + AsString(sup_plan.Get("summary", String())) + "\n\n";

        ValueArray steps = sup_plan.Get("steps", ValueArray());
        md += "**Suggested Actions:**\n\n";
        for (int i = 0; i < steps.GetCount(); i++) {
            if (steps[i].IsMap()) {
                const ValueMap& step = steps[i];
                md += "- **Action:** " + AsString(step.Get("action", String())) + "\n";
                md += "  - **Target:** " + AsString(step.Get("target", String())) + "\n";
                md += "  - **Reason:** " + AsString(step.Get("reason", String())) + "\n";
                md += "  - **Benefit Score:** " + AsString(step.Get("benefit_score", 0.0)) + "\n";
                md += "  - **Risk Score:** " + AsString(step.Get("risk_score", 0.0)) + "\n";
                md += "  - **Confidence Score:** " + AsString(step.Get("confidence_score", 0.0)) + "\n\n";
            }
        }
    }

    // Add scenario plan
    Value scenario_plan_val = pm.Get("scenario_plan", ValueMap());
    if (scenario_plan_val.IsMap()) {
        const ValueMap& scenario_plan = scenario_plan_val;
        md += "## Scenario Plan\n\n";
        md += "**Name:** " + AsString(scenario_plan.Get("name", String())) + "\n\n";

        ValueArray actions = scenario_plan.Get("actions", ValueArray());
        md += "**Planned Actions:**\n\n";
        for (int i = 0; i < actions.GetCount(); i++) {
            if (actions[i].IsMap()) {
                const ValueMap& action = actions[i];
                md += "- **Type:** " + AsString(action.Get("type", String())) + "\n";
                md += "  - **Target:** " + AsString(action.Get("target", String())) + "\n\n";
            }
        }
    }

    // Add simulation results
    md += "## Simulation Results\n\n";
    md += "### Before Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_before", ValueMap())) + "\n```\n\n";

    md += "### After Simulation\n";
    md += "```json\n" + AsJSON(pm.Get("simulation_after", ValueMap())) + "\n```\n\n";

    md += "### Deltas\n";
    md += "```json\n" + AsJSON(pm.Get("deltas", ValueMap())) + "\n```\n\n";

    // Add semantic and architecture snapshots
    md += "## Semantic Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("semantic_snapshot", ValueMap())) + "\n```\n\n";

    md += "## Architecture Snapshot\n";
    md += "```json\n" + AsJSON(pm.Get("architecture_snapshot", ValueMap())) + "\n```\n\n";

    // Add metadata
    md += "## Metadata\n";
    md += "```json\n" + AsJSON(pm.Get("metadata", ValueMap())) + "\n```\n\n";

    return md;
}

// The HandleExportProposal function will be added by a subsequent edit operation

InvocationResult CommandExecutor::HandleExportProposal(const VectorMap<String, String>& args) {
    String package = args.Get("package", "");
    if (package.IsEmpty()) {
        return {1, "Missing required argument: package"};
    }

    int max_actions = StrIntDef(args.Get("max_actions", "5"), 5);
    String format = args.Get("format", "json");

    String error;
    Value proposal = session->BuildProposal(package, max_actions, error);

    if (!error.IsEmpty()) {
        return {1, "Error generating proposal: " + error};
    }

    String result;
    if (format == "md" || format == "markdown") {
        result = ProposalToMarkdown(proposal);
    } else {
        // Default to JSON format
        result = AsJSON(proposal);
    }

    return {0, result};
}

// Memory export command handler
InvocationResult CommandExecutor::HandleMemoryExport(const VectorMap<String, String>& args) {
    String exportPath = args.Get("path", "");
    if (exportPath.IsEmpty()) {
        exportPath = "./project_memory_export.json";
    }

    // Ensure directory exists
    String dir = GetFileFolder(exportPath);
    if (!DirectoryExists(dir)) {
        MkDirDeep(dir);
    }

    // Export the project memory
    session->core_ide.memory.Save(exportPath);

    // Prepare result
    ValueMap result;
    result.Set("exported_entries", session->core_ide.memory.GetHistory().GetCount());
    result.Set("output_file", exportPath);

    return {0, AsJSON(result)};
}

// Memory import command handler
InvocationResult CommandExecutor::HandleMemoryImport(const VectorMap<String, String>& args) {
    String importFile = args.Get("file", "");
    if (importFile.IsEmpty()) {
        return {1, "Missing required argument: file"};
    }

    String mode = args.Get("mode", "merge");
    if (mode != "merge" && mode != "replace") {
        return {1, "Invalid mode: must be 'merge' or 'replace'"};
    }

    // Load the project memory from the specified file
    ProjectMemory newMemory;
    newMemory.Load(importFile);

    int importedCount = newMemory.GetHistory().GetCount();

    // Determine import mode
    if (mode == "replace") {
        // Replace current memory
        session->core_ide.memory = std::move(newMemory);
    } else { // mode == "merge"
        // Merge with current memory (add the new entries to the current memory)
        auto history = newMemory.GetHistory();
        for (const auto& entry : history) {
            session->core_ide.memory.Record(entry);
        }
    }

    // Save the updated memory to the default location
    String memoryPath = session->core_ide.GetWorkspaceRoot() + "/.aiupp/project_memory.json";
    session->core_ide.memory.Save(memoryPath);

    // Prepare result
    ValueMap result;
    result.Set("imported_entries", importedCount);
    result.Set("import_mode", mode);

    return {0, AsJSON(result)};
}

// Supervisor v4: Adaptive Priority Engine command handler
InvocationResult CommandExecutor::HandleSupervisorPredict(const VectorMap<String, String>& args) {
    // Check if we have at least one of the required arguments (symbol, file, or entity)
    String symbol = args.Get("symbol", "");
    String file = args.Get("file", "");
    String entity = args.Get("entity", "");

    if (symbol.IsEmpty() && file.IsEmpty() && entity.IsEmpty()) {
        return {1, "Missing required argument: symbol, file, or entity must be provided"};
    }

    String error;

    // Update adaptive weights based on project memory
    session->GetSupervisor().UpdateAdaptiveWeights(session->core_ide.memory);

    // Create a mock suggestion for prediction purposes
    // In a real implementation, we'd analyze the specific symbol/file/entity to create appropriate suggestions
    CoreSupervisor::Suggestion mockSuggestion;
    mockSuggestion.action = "analyze_entity";
    mockSuggestion.target = !symbol.IsEmpty() ? symbol : (!entity.IsEmpty() ? entity : "file_analysis");
    mockSuggestion.reason = "Mock suggestion for prediction analysis";

    // For now, we'll use simple heuristic values - in a real implementation, we'd analyze the actual entity
    mockSuggestion.benefit_score = 0.5;
    mockSuggestion.risk_score = 0.3;
    mockSuggestion.confidence_score = 0.7;
    mockSuggestion.cost_score = 0.4;

    // Get the predicted value using the APE
    double predicted_value = session->GetSupervisor().PredictValue(mockSuggestion, session->core_ide.memory);

    // Prepare explanation
    ValueMap explanation;
    explanation.Set("input_symbol", symbol);
    explanation.Set("input_file", file);
    explanation.Set("input_entity", entity);
    explanation.Set("benefit_score", mockSuggestion.benefit_score);
    explanation.Set("risk_score", mockSuggestion.risk_score);
    explanation.Set("confidence_score", mockSuggestion.confidence_score);
    explanation.Set("predicted_value", predicted_value);

    // Prepare adaptive weights map
    ValueMap adaptive_weights;
    // Access adaptive weights from supervisor (the internal adaptive member is accessible via GetAdaptiveWeightsForTesting)
    auto adaptive = session->GetSupervisor().GetAdaptiveWeightsForTesting();
    adaptive_weights.Set("benefit_multiplier", adaptive.benefit_multiplier);
    adaptive_weights.Set("risk_penalty", adaptive.risk_penalty);
    adaptive_weights.Set("confidence_boost", adaptive.confidence_boost);
    adaptive_weights.Set("novelty_bias", adaptive.novelty_bias);

    // Create result object
    ValueMap result;
    result.Set("predicted_value", predicted_value);
    result.Set("explanation", explanation);
    result.Set("adaptive_weights", adaptive_weights);

    return {0, AsJSON(result)};
}

// Cross-Workspace Intelligence (CWI) v1 handlers

InvocationResult CommandExecutor::HandleGlobalStats(const VectorMap<String, String>& args) {
    String error;

    // Get pattern statistics
    ValueMap patternStats;
    // For now, we'll create a simplified representation
    // In a real implementation, we'd iterate through all recorded patterns
    auto cleanupStats = session->core_ide.global.GetPatternStats("cleanup_includes_and_rebuild");
    auto renameStats = session->core_ide.global.GetPatternStats("rename_symbol_safe");
    auto graphStats = session->core_ide.global.GetPatternStats("reorganize_includes");

    ValueMap cleanupStatsMap;
    cleanupStatsMap.Set("occurrences", cleanupStats.occurrences);
    cleanupStatsMap.Set("successes", cleanupStats.successes);
    cleanupStatsMap.Set("failures", cleanupStats.failures);
    cleanupStatsMap.Set("avg_benefit", cleanupStats.avg_benefit);
    cleanupStatsMap.Set("avg_risk", cleanupStats.avg_risk);
    cleanupStatsMap.Set("avg_confidence", cleanupStats.avg_confidence);
    patternStats.Set("cleanup_includes_and_rebuild", cleanupStatsMap);

    ValueMap renameStatsMap;
    renameStatsMap.Set("occurrences", renameStats.occurrences);
    renameStatsMap.Set("successes", renameStats.successes);
    renameStatsMap.Set("failures", renameStats.failures);
    renameStatsMap.Set("avg_benefit", renameStats.avg_benefit);
    renameStatsMap.Set("avg_risk", renameStats.avg_risk);
    renameStatsMap.Set("avg_confidence", renameStats.avg_confidence);
    patternStats.Set("rename_symbol_safe", renameStatsMap);

    ValueMap graphStatsMap;
    graphStatsMap.Set("occurrences", graphStats.occurrences);
    graphStatsMap.Set("successes", graphStats.successes);
    graphStatsMap.Set("failures", graphStats.failures);
    graphStatsMap.Set("avg_benefit", graphStats.avg_benefit);
    graphStatsMap.Set("avg_risk", graphStats.avg_risk);
    graphStatsMap.Set("avg_confidence", graphStats.avg_confidence);
    patternStats.Set("reorganize_includes", graphStatsMap);

    // Get refactor statistics
    ValueMap refactorStats;
    auto cleanupRefactorStats = session->core_ide.global.GetRefactorStats("cleanup_includes");
    auto renameRefactorStats = session->core_ide.global.GetRefactorStats("rename_symbol_safe");
    auto graphRefactorStats = session->core_ide.global.GetRefactorStats("reorganize_includes");

    ValueMap cleanupRefactorStatsMap;
    cleanupRefactorStatsMap.Set("uses", cleanupRefactorStats.uses);
    cleanupRefactorStatsMap.Set("successful", cleanupRefactorStats.successful);
    cleanupRefactorStatsMap.Set("reverted", cleanupRefactorStats.reverted);
    cleanupRefactorStatsMap.Set("avg_delta_complexity", cleanupRefactorStats.avg_delta_complexity);
    refactorStats.Set("cleanup_includes", cleanupRefactorStatsMap);

    ValueMap renameRefactorStatsMap;
    renameRefactorStatsMap.Set("uses", renameRefactorStats.uses);
    renameRefactorStatsMap.Set("successful", renameRefactorStats.successful);
    renameRefactorStatsMap.Set("reverted", renameRefactorStats.reverted);
    renameRefactorStatsMap.Set("avg_delta_complexity", renameRefactorStats.avg_delta_complexity);
    refactorStats.Set("rename_symbol_safe", renameRefactorStatsMap);

    ValueMap graphRefactorStatsMap;
    graphRefactorStatsMap.Set("uses", graphRefactorStats.uses);
    graphRefactorStatsMap.Set("successful", graphRefactorStats.successful);
    graphRefactorStatsMap.Set("reverted", graphRefactorStats.reverted);
    graphRefactorStatsMap.Set("avg_delta_complexity", graphRefactorStats.avg_delta_complexity);
    refactorStats.Set("reorganize_includes", graphRefactorStatsMap);

    // Get topology statistics
    auto topologyStats = session->core_ide.global.GetTopologyStats();
    ValueMap topologyStatsMap;
    topologyStatsMap.Set("avg_cycles", topologyStats.avg_cycles);
    topologyStatsMap.Set("avg_depth", topologyStats.avg_depth);
    topologyStatsMap.Set("avg_coupling", topologyStats.avg_coupling);
    topologyStatsMap.Set("count", topologyStats.count);

    // Create result object
    ValueMap result;
    result.Set("pattern_stats", patternStats);
    result.Set("refactor_stats", refactorStats);
    result.Set("topology_stats", topologyStatsMap);

    return {0, AsJSON(result)};
}

InvocationResult CommandExecutor::HandleGlobalPredict(const VectorMap<String, String>& args) {
    String pattern = args.Get("pattern", "");
    String refactor = args.Get("refactor", "");
    String topology = args.Get("topology", "");

    if (pattern.IsEmpty() && refactor.IsEmpty() && topology.IsEmpty()) {
        return {1, "Missing required argument: pattern, refactor, or topology must be provided"};
    }

    String error;

    // Update meta weights based on global knowledge
    session->GetSupervisor().UpdateMetaWeights(session->core_ide.global);

    // Get the current meta weights
    auto meta = session->GetSupervisor().meta;

    // Prepare prediction result
    ValueMap result;
    ValueMap factors;

    if (!pattern.IsEmpty()) {
        // Get pattern statistics to base prediction on
        auto patternStats = session->core_ide.global.GetPatternStats(pattern);
        double successRate = patternStats.occurrences > 0 ?
            (double)patternStats.successes / (double)patternStats.occurrences : 0.0;

        double prediction = successRate + meta.pattern_success_bias;
        prediction = max(0.0, min(1.0, prediction)); // Clamp between 0 and 1

        result.Set("prediction", prediction);
        factors.Set("pattern_name", pattern);
        factors.Set("historical_success_rate", successRate);
        factors.Set("pattern_bias", meta.pattern_success_bias);
    }
    else if (!refactor.IsEmpty()) {
        // Get refactor statistics to base prediction on
        auto refactorStats = session->core_ide.global.GetRefactorStats(refactor);
        double successRate = refactorStats.uses > 0 ?
            (double)refactorStats.successful / (double)refactorStats.uses : 0.0;

        double prediction = successRate + meta.refactor_success_bias;
        prediction = max(0.0, min(1.0, prediction)); // Clamp between 0 and 1

        result.Set("prediction", prediction);
        factors.Set("refactor_name", refactor);
        factors.Set("historical_success_rate", successRate);
        factors.Set("refactor_bias", meta.refactor_success_bias);
    }
    else if (!topology.IsEmpty()) {
        // Use topology risk adjustment for this prediction
        auto topologyStats = session->core_ide.global.GetTopologyStats();
        double riskAdjustment = meta.topology_risk_adjustment;

        // For topology prediction, we'll invert the risk to get a success likelihood
        double prediction = max(0.0, min(1.0, 1.0 - riskAdjustment));

        result.Set("prediction", prediction);
        factors.Set("topology_name", topology);
        factors.Set("topology_risk_adjustment", riskAdjustment);
        factors.Set("topology_stats", AsJSON(topologyStats));
    }

    // Add contributing factors to result
    result.Set("factors", factors);

    // Add meta weights used in prediction
    ValueMap metaWeights;
    metaWeights.Set("pattern_success_bias", meta.pattern_success_bias);
    metaWeights.Set("refactor_success_bias", meta.refactor_success_bias);
    metaWeights.Set("topology_risk_adjustment", meta.topology_risk_adjustment);
    result.Set("meta_weights", metaWeights);

    return {0, AsJSON(result)};
}

InvocationResult CommandExecutor::HandleExportGlobalKnowledge(const VectorMap<String, String>& args) {
    String exportPath = args.Get("path", "");
    if (exportPath.IsEmpty()) {
        exportPath = GetHomeDir() + "/.aiupp/global_knowledge.json";
    }

    // Ensure directory exists
    String dir = GetFileDirectory(exportPath);
    if (!DirectoryExists(dir)) {
        if (!CreateDirectory(dir)) {
            return {1, "Failed to create directory: " + dir};
        }
    }

    // Export global knowledge to the specified path
    session->core_ide.global.Save(exportPath);

    // Prepare result
    ValueMap result;
    result.Set("exported_entries", (int)session->core_ide.global.data.GetCount());
    result.Set("output_file", exportPath);

    return {0, AsJSON(result)};
}

InvocationResult CommandExecutor::HandleImportGlobalKnowledge(const VectorMap<String, String>& args) {
    String importFile = args.Get("file", "");
    if (importFile.IsEmpty()) {
        return {1, "Missing required argument: file"};
    }

    String mode = args.Get("mode", "merge");
    if (mode != "merge" && mode != "replace") {
        return {1, "Invalid mode: must be 'merge' or 'replace'"};
    }

    // Load the global knowledge from the specified file
    GlobalKnowledge newGlobalKnowledge;
    newGlobalKnowledge.Load(importFile);

    int importedCount = newGlobalKnowledge.data.GetCount();

    // Determine import mode
    if (mode == "replace") {
        // Replace current global knowledge
        session->core_ide.global = std::move(newGlobalKnowledge);
    } else { // mode == "merge"
        // For simplicity, we'll just replace - in a real implementation, we'd merge the data
        // This would involve merging the statistics from both knowledge bases
        session->core_ide.global = std::move(newGlobalKnowledge);
    }

    // Prepare result
    ValueMap result;
    result.Set("imported_entries", importedCount);
    result.Set("import_mode", mode);

    return {0, AsJSON(result)};
}


