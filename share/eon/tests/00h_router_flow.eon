// PacketRouter Test: Runtime packet flow verification
// Verifies that packets actually flow through the router during main loop
// Tests: packets_routed counter increments, data reaches sink atoms

machine audio.gen.flow:
	net tester.flow:
		// Runtime flow regression for PacketRouter Phase 4 (debug audio/video, SDL, PortMidi)
		center.audio.src.dbg_generator:
			waveform = "noise"
			dbg_limit = 64
		center.video.src.dbg_generator:
			mode = "noise"
		sdl.audio
		sdl.video.pipe
		center.customer
		sdl.event.pipe
		state.event.pipe:
			target = "/event/register"
		midi.src.side.portmidi:
			loop = "input"
		midi.null.sink

		connections:
			center.audio.src.dbg_generator.0 -> sdl.audio.0
			center.video.src.dbg_generator.0 -> sdl.video.pipe.0
			center.customer.0 -> sdl.event.pipe.0
			sdl.event.pipe.0 -> state.event.pipe.0
			midi.src.side.portmidi.0 -> midi.null.sink.0
